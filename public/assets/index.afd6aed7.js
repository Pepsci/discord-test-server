var z=Object.defineProperty,H=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var V=(t,s,n)=>s in t?z(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,b=(t,s)=>{for(var n in s||(s={}))Y.call(s,n)&&V(t,n,s[n]);if(O)for(var n of O(s))K.call(s,n)&&V(t,n,s[n]);return t},y=(t,s)=>H(t,J(s));import{a as L,j as A,R as P,r,u as W,L as w,l as G,N as Q,O as X,b as Z,c as U,d as ee,B as te}from"./vendor.b6c3d911.js";const se=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))h(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&h(p)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function h(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}};se();const M=L.create({baseURL:"https://projet3-discord.herokuapp.com",withCredentials:!0});M.interceptors.request.use(t=>{const s=localStorage.getItem("authToken");return t.headers.Authorization=s?`Bearer ${s}`:"",t});function $(t){throw t.response.data&&console.log(t.response&&t.response.data),t}const k=y(b({},M),{signup(t){return M.post("/signup",t).then(s=>s.data).catch($)},isLoggedIn(t){return M.get("/auth/verify",{headers:{Authorization:`Bearer ${t}`}}).then(s=>s.data).catch($)},signin(t){return M.post("/login",t).then(s=>s.data).catch($)}}),e=A.exports.jsx,i=A.exports.jsxs,q=A.exports.Fragment,_=P.createContext();function ne({children:t}){const[s,n]=r.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});r.exports.useEffect(()=>{h()},[]);const h=()=>{const c=localStorage.getItem("authToken");c?k.isLoggedIn(c).then(m=>{n({currentUser:m,isLoading:!1,isLoggedIn:!0})}).catch(m=>{n({currentUser:null,isLoading:!1,isLoggedIn:!1})}):n({currentUser:null,isLoading:!1,isLoggedIn:!1})},a=()=>{o(),h()},o=()=>{localStorage.removeItem("authToken")},p=c=>{localStorage.setItem("authToken",c)},v={currentUser:s.currentUser,isLoading:s.isLoading,isLoggedIn:s.isLoggedIn,storeToken:p,authenticateUser:h,removeUser:a,removeToken:o};return e(_.Provider,{value:v,children:t})}const re=()=>{const[t,s]=r.exports.useState({username:"",email:"",password:""});r.exports.useState();const[n,h]=r.exports.useState(void 0),{authenticateUser:a,isLoggedIn:o}=r.exports.useContext(_),p=r.exports.useRef(null),v=W();r.exports.useEffect(()=>{a(),o&&v("/dashboard")},[o]);const c=u=>{L.get(`https://avatars.dicebear.com/api/bottts/${u}.svg`).then(({data:f})=>{p.current=f}).catch(f=>console.log(f))};return i("div",{children:[i("form",{className:"form",onSubmit:async u=>{u.preventDefault();try{await L.post("https://projet3-discord.herokuapp.com/signup",t),v("/login")}catch(f){h(l=>f.response.data.message),console.error(f)}},children:[e("label",{className:"form-label",htmlFor:"username",children:"username"}),e("input",{className:"form-input",placeholder:"Enter your Username",type:"text",name:"username",value:t.username,onChange:u=>{s(y(b({},t),{username:u.target.value})),c(u.target.value)}}),e("label",{className:"form-label",htmlFor:"email",children:"email"}),e("input",{placeholder:"Enter your Email",className:"form-input",type:"text",name:"email",value:t.email,onChange:u=>s(y(b({},t),{email:u.target.value}))}),e("label",{className:"form-label",htmlFor:"password",children:"password"}),e("input",{placeholder:"Enter your password",className:"form-input",type:"text",name:"password",value:t.password,onChange:u=>s(y(b({},t),{password:u.target.value}))}),i("div",{children:[e("p",{children:"This will be your profile pic"}),e("img",{src:`https://avatars.dicebear.com/api/bottts/${t.username}.svg`,alt:""})]}),e("button",{children:"Sign up"})]}),n&&e("p",{className:"error-message",children:n}),e(w,{to:"/login",children:" Already have an account ? Click here to login"})]})},ae=()=>{const[t,s]=r.exports.useState({email:"",password:""}),[n,h]=r.exports.useState(void 0),{storeToken:a,authenticateUser:o,isLoggedIn:p}=r.exports.useContext(_),v=W();return r.exports.useEffect(()=>{o(),p&&v("/dashboard")},[p]),i("div",{children:[i("form",{className:"form",onSubmit:async m=>{m.preventDefault();try{const u=await k.post("/login",t);a(u.data.authToken),o(),v("/dashboard")}catch(u){const f=u.response.data.message;h(f)}},children:[e("label",{className:"form-label",htmlFor:"email",children:"email"}),e("input",{placeholder:"Enter your Email",className:"form-input",type:"text",name:"email",value:t.email,onChange:m=>s(y(b({},t),{email:m.target.value}))}),e("label",{className:"form-label",htmlFor:"password",children:"password"}),e("input",{placeholder:"Enter your password",className:"form-input",type:"text",name:"password",value:t.password,onChange:m=>s(y(b({},t),{password:m.target.value}))}),e("button",{children:"Log in"})]}),n&&e("p",{className:"error-message",children:n}),e(w,{to:"/",children:" Not a member yet ? Sign-up !"})]})},E=()=>r.exports.useContext(_);const N=P.createContext();function oe(t){const{currentUser:s,isLoggedIn:n}=E(),[h,a]=r.exports.useState([]),[o,p]=r.exports.useState(!1),[v,c]=r.exports.useState({}),[m,u]=r.exports.useState([]),[f,l]=r.exports.useState(null),C=g=>{u([...m,g])},[D,T]=r.exports.useState([]),[B,j]=r.exports.useState(""),F=localStorage.getItem("authToken"),I=r.exports.useRef();r.exports.useEffect(()=>{if(!n)return;const g=G("https://projet3-discord.herokuapp.com",{withCredentials:!0});return g.on("connected",()=>{console.log("CurrentUser",s),console.log("socket",g),console.log("succesfully connected with socket.io server")}),g.auth={email:s==null?void 0:s.email,id:s==null?void 0:s._id,token:F},g.on("users",d=>{d.map(x=>{x.self=x._id===g.auth.id}),d=d.sort((x,S)=>x.self?-1:S.self?1:x.username<S.username?-1:x.username>S.username?1:0),a(x=>d)}),f!==null&&g.emit("chan-join",f),g.on("user joined",d=>{j(d)}),g.emit("user update",o),g.on("disconnect",()=>{console.log("user just disconnected")}),g.on("user disconnected",()=>{console.log("disconnected user is",g.id)}),I.current=g,()=>{g.disconnect(),I.current=null}},[n,f]);const R={socket:I.current,connectedUsers:h,userUpdated:o,setUserUpdated:p,setNewChan:c,chans:m,setChans:u,addChan:C,joinChan:f,setJoinChan:l,prevMess:D};return e(N.Provider,{value:R,children:t.children})}const ce=()=>{const{connectedUsers:t,userUpdated:s}=r.exports.useContext(N);return r.exports.useEffect(()=>{console.log("is user updated ?",s)},[t,s]),console.log("Component{UsersList} => connectedUsers",t),i("div",{children:[e("p",{children:" users list"}),t.map(n=>n.self?e("div",{children:i("p",{children:[n.username,"(yourself)"]})},n._id):e("div",{children:e("p",{children:n.username})},n._id))]})};r.exports.createContext();const ie=()=>{const{currentUser:t}=E(),{setNewChan:s,chans:n,setChans:h,addChan:a}=r.exports.useContext(N),o=t._id;console.log("who is the owner ?",o);const[p,v]=r.exports.useState({name:"",owner:o}),[c,m]=r.exports.useState(!1),u=async l=>{l.preventDefault;try{const C=await L.post("https://projet3-discord.herokuapp.com/chan",p);m(!0),a(C.data),m(!1),s(C.data)}catch(C){console.error(C)}};r.exports.useEffect(()=>{L.get("https://projet3-discord.herokuapp.com/chan").then(l=>{console.log(l.data),h(l.data)}).catch(l=>console.error(l))},[c]);const f=n.filter(l=>l.owner._id===o);return n?e(q,{children:i("div",{className:"chanList-content",children:[i("div",{className:"chanList-header",children:[e("h2",{children:"Chan List Perso"}),i("div",{className:"creteNewChan",children:[e("label",{htmlFor:"name",children:"Name"}),e("input",{type:"text",id:"name",value:p.name,onChange:l=>v(y(b({},p),{name:l.target.value}))}),e("button",{onClick:u,children:"Create a channel"})]})]}),e("div",{children:f.map(l=>e(w,{to:`/chan/${l._id}`,children:i("div",{className:"chanList-chan",children:[e("img",{className:"chanList-image",src:l.image,alt:l.name}),e("p",{children:l.name})]})},l._id))})]})}):e("p",{children:"loading..."})};const le=()=>{const{chans:t,setChans:s,setJoinChan:n,joinChan:h}=r.exports.useContext(N);return r.exports.useEffect(()=>{L.get("https://projet3-discord.herokuapp.com/chan",t).then(a=>s(a.data)).catch(a=>console.error(a))},[]),t?e(q,{children:i("div",{className:"chanList-content",children:[i("div",{className:"chanList-header",children:[e("h2",{children:"Chan List global"}),e("div",{className:"searchChan"})]}),t.map(a=>e(w,{onClick:()=>{n(o=>a._id)},to:`/chan/${a._id}`,children:i("div",{className:"chanList-chan",children:[e("img",{className:"chanList-image",src:a.image,alt:a.name}),e("p",{children:a.name})]})},a._id))]})}):e("p",{children:"loading..."})};const de=()=>{const{currentUser:t,isLoggedIn:s,removeUser:n,storeToken:h,authenticateUser:a}=E(),{socket:o,setUserUpdated:p,userUpdated:v}=r.exports.useContext(N),[c,m]=r.exports.useState({_id:"",username:"",email:"",avatar:""}),[u,f]=r.exports.useState(!1),[l,C]=r.exports.useState(!1),D=r.exports.useRef();r.exports.useEffect(()=>{t&&k.get("/user",t._id).then(d=>{m(d.data)}).catch(d=>{console.log(d)}),s||m(null)},[s]);const T=d=>{d.preventDefault(),f(!0)},B=async d=>{d.preventDefault();const x=new FormData;x.append("username",c.username),x.append("email",c.email),x.append("avatar",D.current.files[0]),console.log("the current avatar ref is :",D.current.files[0]);try{const S=await k.patch(`/user/${c._id}`,x,{headers:{"content-type":"multipart/form-data"}});h(S.data.authToken),a(),m(ye=>S.data.payload),p(!0),f(!u),p(!1)}catch(S){console.error(S)}},j=async d=>{d.preventDefault(),o.disconnect(),n()},F=d=>{d.preventDefault(),C(!0)},I=d=>{d.preventDefault(),C(!1),f(!0)},R=d=>{d.preventDefault(),f(!1)},g=async d=>{d.preventDefault();try{await k.delete(`/user/${c._id}`),o.disconnect(),n(),C(!1),f(!1)}catch(x){console.error(x)}};return t?i("div",{children:[l&&i("div",{className:"delete-mode container",children:[e("p",{children:"Are you sure ? This means goodbye... forever"}),e("button",{className:"profil-btn",onClick:I,children:"Nope nope nopity nope"}),e("button",{className:"profil-btn",onClick:g,children:"Delete for good"})]}),u&&i("form",{className:"edit-mode container",children:[e("label",{htmlFor:"username",children:"Username"}),e("input",{type:"text",id:"username",value:c.username,onChange:d=>{m(y(b({},c),{username:d.target.value}))}}),e("label",{htmlFor:"email",children:"Email"}),e("input",{type:"text",id:"email",value:c.email,onChange:d=>{m(y(b({},c),{email:d.target.value}))}}),e("label",{htmlFor:"avatar",children:"avatar"}),e("input",{type:"file",name:"avatar",id:"avatar",ref:D}),e("button",{className:"profil-btn",onClick:B,children:"Send"}),i("button",{className:"profil-btn",onClick:R,children:[" ","Nevermind, this is fine"]}),e("button",{className:"profil-btn",onClick:F,children:"Delete my account"})]}),!u&&i("div",{className:"display-mode container",children:[e("p",{className:"display-mode username",children:c==null?void 0:c.username}),e("p",{className:"display-mode email",children:c==null?void 0:c.email}),e("img",{className:"display-mode avatar",src:c==null?void 0:c.avatar,alt:c==null?void 0:c.username}),i("div",{className:"display-mode icons-container",children:[e("i",{className:"fas fa-user-edit display-mode icon",onClick:T}),e("i",{onClick:j,className:"fa-solid fa-right-from-bracket display-mode icon"})]})]})]}):e("p",{children:"loading"})},ue=()=>i("div",{className:"profil__container",children:[e("h2",{children:"Your profile"}),e(de,{})]}),he=()=>{const{currentUser:t,authenticateUser:s}=E(),[n,h]=r.exports.useState([]),[a,o]=r.exports.useState([]);r.exports.useContext(N),r.exports.useEffect(()=>{localStorage.getItem("authToken")&&s()},[]);const p=v=>{o([...a,v])};return n?i("div",{children:[e("h1",{children:"Dashboard"}),i("div",{className:"dashboard",children:[e("div",{className:"userList",children:e(ce,{users:n})}),e("div",{className:"creatChan",children:e(ie,{addChan:p})}),e("div",{className:"chanList",children:e(le,{setChans:o,chans:a})}),e("div",{className:"chat"}),e(ue,{})]})]}):e("p",{children:" loading..."})},pe=()=>{const{isLoggedIn:t,isLoading:s}=E();return s?e("p",{children:"Loading..."}):t?e(X,{}):e(Q,{to:"/login"})},me=()=>i("div",{children:[e("p",{children:"Sorry, it seems you're looking for something that doesn't exist..."}),e(w,{to:"/",children:"\u{1F3B5} Take me home, to the place I belong \u{1F3B5}"})]}),fe=()=>{const[t,s]=r.exports.useState(""),[n,h]=r.exports.useState([]),{joinChan:a,socket:o,welcomeMess:p}=r.exports.useContext(N),{currentUser:v}=E(),[c,m]=r.exports.useState(!1),u=()=>{console.log(a),k.get(`/chan/${a}/messages`).then(l=>{h(l.data)}).catch(l=>console.error(l))};r.exports.useEffect(()=>{u(),o.on("receive-message",()=>{u(),m(!c)})},[c]);const f=l=>{l.preventDefault(),t!==""&&(o.emit("send-message",{content:t,author:v._id,chan:a}),s(""))};return i("div",{children:[i("div",{className:"sentMessages",children:[e("h2",{children:"chat"}),n.map(l=>i("div",{children:[e("p",{children:l.content}),i("p",{children:["Sent by ",l.author.username]})]},l._id))]}),e("p",{children:p}),i("div",{className:"sendMessage",children:[e("input",{type:"text",value:t,onChange:l=>s(l.target.value)}),e("button",{onClick:f,children:"Submit"})]})]})},ge=()=>{const{connectedUsers:t,userUpdated:s}=r.exports.useContext(N);return r.exports.useEffect(()=>{console.log("is user updated ?",s)},[t,s]),console.log("Component{UsersList} => connectedUsers",t),i("div",{children:[e("p",{children:" users list"}),t.map(n=>n.self?e("div",{children:i("p",{children:[n.username,"(yourself)"]})},n._id):e("div",{children:e("p",{children:n.username})},n._id))]})};function ve(){r.exports.useState({});const{joinChan:t}=r.exports.useContext(N),[s,n]=r.exports.useState({});return r.exports.useEffect(()=>{console.log(t),k.get(`/chan/${t}`).then(h=>{n(a=>h.data)}).catch(h=>console.error(h))},[]),s?(console.log(s),i("div",{children:[i("h2",{children:[" You are on ",s.name]}),e("img",{src:s.image,alt:s.name,style:{width:"100px",borderRadius:"50%"}}),e(w,{to:"/dashboard",children:"Leave this chat"}),e(ge,{}),e(fe,{})]})):e("p",{children:" loading..."})}function xe(){return e("div",{className:"App",children:i(Z,{children:[e(U,{path:"/",element:e(re,{})}),e(U,{path:"/login",element:e(ae,{})}),i(U,{element:e(pe,{}),children:[e(U,{path:"/dashboard",element:e(he,{})}),e(U,{path:"/chan/:id",element:e(ve,{})})]}),e(U,{path:"*",element:e(me,{})})]})})}const Ce=r.exports.createContext();function be(t){const[s,n]=r.exports.useState([]);return e(Ce.Provider,{value:{users:s,setUsers:n},children:t.children})}ee.render(e(P.StrictMode,{children:e(te,{children:e(ne,{children:e(oe,{children:e(be,{children:e(xe,{})})})})})}),document.getElementById("root"));
