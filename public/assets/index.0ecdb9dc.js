var z=Object.defineProperty,K=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var Y=(a,t,n)=>t in a?z(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,S=(a,t)=>{for(var n in t||(t={}))Q.call(t,n)&&Y(a,n,t[n]);if(J)for(var n of J(t))X.call(t,n)&&Y(a,n,t[n]);return a},k=(a,t)=>K(a,G(t));import{a as B,R as V,r as s,j as e,u as q,b as r,L as _,l as Z,F as O,N as ee,O as te,B as ae,P as se,c as ne,d as M,e as re,f as oe}from"./vendor.96790f29.js";const ce=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))v(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const p of l.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&v(p)}).observe(document,{childList:!0,subtree:!0});function n(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerpolicy&&(l.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?l.credentials="include":c.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function v(c){if(c.ep)return;c.ep=!0;const l=n(c);fetch(c.href,l)}};ce();const T=B.create({baseURL:"https://projet3-discord.herokuapp.com",withCredentials:!0});T.interceptors.request.use(a=>{const t=localStorage.getItem("authToken");return a.headers.Authorization=t?`Bearer ${t}`:"",a});function W(a){throw a.response.data&&console.log(a.response&&a.response.data),a}const b=k(S({},T),{signup(a){return T.post("/signup",a).then(t=>t.data).catch(W)},isLoggedIn(a){return T.get("/auth/verify",{headers:{Authorization:`Bearer ${a}`}}).then(t=>t.data).catch(W)},signin(a){return T.post("/login",a).then(t=>t.data).catch(W)}}),P=V.createContext();function le({children:a}){const[t,n]=s.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});s.exports.useEffect(()=>{v()},[]);const v=()=>{const o=localStorage.getItem("authToken");o?b.isLoggedIn(o).then(h=>{n({currentUser:h,isLoading:!1,isLoggedIn:!0})}).catch(h=>{n({currentUser:null,isLoading:!1,isLoggedIn:!1})}):n({currentUser:null,isLoading:!1,isLoggedIn:!1})},c=()=>{l(),v()},l=()=>{localStorage.removeItem("authToken")},p=o=>{localStorage.setItem("authToken",o)},i={currentUser:t.currentUser,isLoading:t.isLoading,isLoggedIn:t.isLoggedIn,storeToken:p,authenticateUser:v,removeUser:c,removeToken:l};return e(P.Provider,{value:i,children:a})}const ie=()=>{const[a,t]=s.exports.useState({username:"",email:"",password:""});s.exports.useState();const[n,v]=s.exports.useState(void 0),{authenticateUser:c,isLoggedIn:l}=s.exports.useContext(P),p=s.exports.useRef(null),i=q();s.exports.useEffect(()=>{c(),l&&i("/dashboard")},[l]);const o=f=>{B.get(`https://avatars.dicebear.com/api/bottts/${f}.svg`).then(({data:g})=>{p.current=g}).catch(g=>console.log(g))};return r("div",{className:"formConnect",children:[r("form",{className:"form",onSubmit:async f=>{f.preventDefault();try{await B.post("https://projet3-discord.herokuapp.com/signup",a),i("/login")}catch(g){v(d=>g.response.data.message),console.error(g)}},children:[e("label",{className:"form-label",htmlFor:"username",children:"username"}),e("input",{className:"form-input",placeholder:"Enter your Username",type:"text",name:"username",value:a.username,onChange:f=>{t(k(S({},a),{username:f.target.value})),o(f.target.value)}}),e("label",{className:"form-label",htmlFor:"email",children:"email"}),e("input",{placeholder:"Enter your Email",className:"form-input",type:"text",name:"email",value:a.email,onChange:f=>t(k(S({},a),{email:f.target.value}))}),e("label",{className:"form-label",htmlFor:"password",children:"password"}),e("input",{placeholder:"Enter your password",className:"form-input",type:"text",name:"password",value:a.password,onChange:f=>t(k(S({},a),{password:f.target.value}))}),r("div",{className:"formConnect-avatar",children:[e("p",{className:"formConnect-msg",children:"This will be your profile pic"}),e("img",{src:`https://avatars.dicebear.com/api/bottts/${a.username}.svg`,alt:""})]}),e("button",{children:"Sign up"})]}),r("div",{className:"formConnect-msg",children:[n&&e("p",{className:"error-message",children:n}),e(_,{to:"/login",children:e("span",{className:"formConnect-msg",children:"Already have an account ? Click here to login"})})]})]})},de=()=>{const[a,t]=s.exports.useState({email:"",password:""}),[n,v]=s.exports.useState(void 0),{storeToken:c,authenticateUser:l,isLoggedIn:p}=s.exports.useContext(P),i=q();return s.exports.useEffect(()=>{l(),p&&i("/dashboard")},[p]),r("div",{className:"formConnect",children:[r("form",{className:"form",onSubmit:async h=>{h.preventDefault();try{const f=await b.post("/login",a);c(f.data.authToken),l(),i("/dashboard")}catch(f){const g=f.response.data.message;v(g)}},children:[e("label",{className:"form-label",htmlFor:"email",children:"Email"}),e("input",{placeholder:"Enter your Email",className:"form-input",type:"text",name:"email",value:a.email,onChange:h=>t(k(S({},a),{email:h.target.value}))}),e("label",{className:"form-label",htmlFor:"password",children:"Password"}),e("input",{placeholder:"Enter your password",className:"form-input",type:"text",name:"password",value:a.password,onChange:h=>t(k(S({},a),{password:h.target.value}))}),e("button",{children:"Log in"})]}),r("div",{className:"formConnect-msg",children:[n&&e("p",{className:"error-message",children:n}),e(_,{to:"/",children:e("span",{className:"formConnect-msg",children:" Not a member yet ? Sign-up !"})})]})]})},I=()=>s.exports.useContext(P);const w=V.createContext();function ue(a){const{currentUser:t,isLoggedIn:n}=I(),[v,c]=s.exports.useState([]),[l,p]=s.exports.useState(!1),[i,o]=s.exports.useState({}),[h,f]=s.exports.useState([]),[g,d]=s.exports.useState(null),y=C=>{f([...h,C])},[L,D]=s.exports.useState([]),[F,$]=s.exports.useState(""),A=localStorage.getItem("authToken"),U=s.exports.useRef();s.exports.useEffect(()=>{console.log("---> chans from socket context are",h)},[h]),s.exports.useEffect(()=>{if(!n)return;const C=Z("https://projet3-discord.herokuapp.com",{withCredentials:!0});return C.on("connected",()=>{console.log("CurrentUser",t),console.log("socket",C),console.log("succesfully connected with socket.io server")}),C.auth={email:t==null?void 0:t.email,id:t==null?void 0:t._id,token:A},C.on("users",m=>{m.map(x=>{x.self=x._id===C.auth.id}),m=m.sort((x,E)=>x.self?-1:E.self?1:x.username<E.username?-1:x.username>E.username?1:0),c(m)}),g!==null&&C.emit("chan-join",g),C.on("user joined",m=>{$(m)}),C.emit("user update",l),C.on("disconnect",()=>{console.log("user just disconnected")}),C.on("user disconnected",()=>{console.log("disconnected user is",C.id)}),U.current=C,()=>{C.disconnect(),U.current=null}},[n,g]);const R={socket:U.current,connectedUsers:v,userUpdated:l,setUserUpdated:p,setNewChan:o,chans:h,setChans:f,addChan:y,joinChan:g,setJoinChan:d,prevMess:L};return e(w.Provider,{value:R,children:a.children})}const he=()=>{const{currentUser:a}=I(),{chans:t,setChans:n,addChan:v,setJoinChan:c}=s.exports.useContext(w),l=a._id,[p,i]=s.exports.useState({name:"",owner:l}),[o,h]=s.exports.useState({name:"",image:""}),[f,g]=s.exports.useState(!1),[d,y]=s.exports.useState(!1),L=s.exports.useRef(),[D,F]=s.exports.useState(!1),[$,A]=s.exports.useState([]);s.exports.useEffect(()=>{b.get("/chan").then(u=>{console.log("SERIOUSLY ?? db reponse just before setChans =>",u.data),n(u.data)}).catch(u=>console.error(u))},[D,o]),s.exports.useEffect(()=>{console.log("useEffect : where are the chans ? :",t),A(t.filter(u=>u.owner._id===l))},[D,t,p]);const U=async u=>{u.preventDefault;try{const N=await b.post("/chan",p);F(!0),v(N.data),F(!1),i(k(S({},p),{name:""}))}catch(N){console.error(N)}},R=u=>{b.get(`/chan/${u}`).then(N=>{h(N.data),console.log(N.data)}).catch(N=>{console.error(N)}),g(!0)},C=async u=>{u.preventDefault();const N=new FormData;N.append("name",o.name),N.append("image",L.current.files[0]);try{console.log("chanToUpdate",o);const j=await b.patch(`/chan/${o._id}`,N);h(Ue=>j.data),g(!f)}catch(j){console.error(j)}},m=u=>{u.preventDefault(),g(!1)},x=u=>{u.preventDefault(),y(!0)},E=u=>{u.preventDefault(),y(!1),g(!0)},H=async u=>{try{await b.delete(`/chan/${o._id}`),y(!1),g(!1)}catch{}};return t?r("div",{children:[f&&r("div",{children:[e("span",{children:"Edit your channel"}),r("form",{className:"formEdit-form",children:[e("label",{className:"formEdit-label",htmlFor:"name",children:"Name"}),e("input",{className:"formEdit-input",type:"text",value:o.name,onChange:u=>h(k(S({},o),{name:u.target.value}))}),e("label",{className:"formEdit-label",htmlFor:"name",children:"Image"}),e("input",{className:"formEdit-input-file",ref:L,type:"file",name:"image"}),r("div",{className:"formEdit-btn",children:[e("button",{onClick:C,children:"Edit"}),e("button",{onClick:m,children:"Cancel Edit"}),e("button",{onClick:x,children:"Delete Chan"})]})]})]}),d&&e(O,{children:r("div",{className:"formEdit-deleteMode",children:[e("p",{children:"Are you sure ?r"}),r("div",{className:"formEdit-deleteMode-btn",children:[e("button",{onClick:E,children:"Nope nope nopity nope"}),e("button",{onClick:H,children:"Delete for good"})]})]})}),!f&&r("div",{className:"chanlist",children:[r("div",{className:"chanList-header",children:[e("span",{children:"Your own channels"}),r("div",{className:"create-chan",children:[e("input",{placeholder:"Enter a name for a new channel",type:"text",id:"name",value:p.name,onChange:u=>i(k(S({},p),{name:u.target.value}))}),e("span",{onClick:U,children:"Create"})]})]}),e("div",{className:"chanList-content",children:$.map(u=>r("div",{className:"chanList-chan",children:[e(_,{onClick:()=>{c(N=>u._id)},to:`/chan/${u._id}`,children:r("div",{className:"chanList-chan-content",children:[e("img",{className:"chanList-image",src:u.image,alt:u.name}),e("span",{children:u.name})]})}),e("div",{className:"chanList-editBtn",children:e("i",{className:"fa-solid fa-wrench ",onClick:()=>R(u._id)})})]},u._id+"filtered"))})]})]}):e("p",{children:"loading..."})},me=({searchChan:a,callbackSearch:t})=>e(O,{children:e("input",{type:"text",placeholder:"Search for a specific chan",value:a,onChange:n=>t(n.target.value)})}),pe=()=>{const{chans:a,setChans:t,setJoinChan:n,joinChan:v}=s.exports.useContext(w),[c,l]=s.exports.useState("");if(!a)return e("p",{children:"loading..."});s.exports.useEffect(()=>{b.get("/chan").then(i=>t(i.data)).catch(i=>console.error(i))},[]);let p=null;return c!==""?p=a.filter(i=>i.name.toLowerCase().includes(c.toLowerCase())):p=a,e(O,{children:r("div",{className:"chanlist",children:[r("div",{className:"chanList-header",children:[e("span",{children:"All channels"}),e("div",{className:"searChan",children:e(me,{searchChan:c,callbackSearch:l})})]}),e("div",{className:"chanList-content",children:p.map(i=>e("div",{className:"chanList-chan",children:e(_,{onClick:()=>{n(o=>i._id)},to:`/chan/${i._id}`,children:r("div",{className:"chanList-chan-content",children:[e("img",{className:"chanList-image",src:i.image,alt:i.name}),e("span",{children:i.name})]})})},i._id+"chan"))})]})})};const fe=()=>{const{currentUser:a,isLoggedIn:t,removeUser:n,storeToken:v,authenticateUser:c}=I(),{socket:l,setUserUpdated:p,userUpdated:i}=s.exports.useContext(w),[o,h]=s.exports.useState({_id:"",username:"",email:"",avatar:""}),[f,g]=s.exports.useState(!1),[d,y]=s.exports.useState(!1),L=s.exports.useRef();s.exports.useEffect(()=>{a&&b.get("/user",a._id).then(m=>{h(m.data)}).catch(m=>{console.log(m)}),t||h(null)},[t]);const D=m=>{m.preventDefault(),g(!0)},F=async m=>{m.preventDefault();const x=new FormData;x.append("username",o.username),x.append("email",o.email),x.append("avatar",L.current.files[0]),console.log("the current avatar ref is :",L.current.files[0]);try{const E=await b.patch(`/user/${o._id}`,x,{headers:{"content-type":"multipart/form-data"}});v(E.data.authToken),c(),h(H=>E.data.payload),p(!0),g(!f),p(!1)}catch(E){console.error(E)}},$=async m=>{m.preventDefault(),l.disconnect(),n()},A=m=>{m.preventDefault(),y(!0)},U=m=>{m.preventDefault(),y(!1),g(!0)},R=m=>{m.preventDefault(),g(!1)},C=async m=>{m.preventDefault();try{await b.delete(`/user/${o._id}`),l.disconnect(),n(),y(!1),g(!1)}catch(x){console.error(x)}};return a?r("div",{children:[f&&e("div",{children:r("form",{className:"formEdit-form",children:[e("label",{className:"formEdit-label",htmlFor:"username",children:"Username"}),e("input",{className:"formEdit-input",type:"text",id:"username",value:o.username,onChange:m=>{h(k(S({},o),{username:m.target.value}))}}),e("label",{className:"formEdit-label",htmlFor:"email",children:"Email"}),e("input",{className:"formEdit-input",type:"text",id:"email",value:o.email,onChange:m=>{h(k(S({},o),{email:m.target.value}))}}),e("label",{className:"formEdit-label",htmlFor:"avatar",children:"avatar"}),e("input",{className:"formEdit-input-file",type:"file",name:"avatar",id:"avatar",ref:L}),e("button",{onClick:F,children:"Send"}),e("button",{onClick:R,children:" Nevermind, this is fine"}),e("button",{onClick:A,children:"Delete my account"})]})}),d&&r("div",{className:"formEdit-deleteMode",children:[e("p",{children:"Are you sure ? This means goodbye... forever"}),e("button",{onClick:U,children:"Nope nope nopity nope"}),e("button",{onClick:C,children:"Delete for good"})]}),!f&&r("div",{className:"profil-detail",children:[r("span",{children:["Hello ",o==null?void 0:o.username]}),e("img",{src:o==null?void 0:o.avatar,alt:o==null?void 0:o.username,onClick:D}),r("div",{className:"profil-btn",children:[e("i",{className:"fas fa-user-edit",onClick:D}),e("i",{onClick:$,className:"fa-solid fa-right-from-bracket"})]})]})]}):e("p",{children:"loading"})},ge=()=>e("div",{className:"profil__container",children:e(fe,{})}),ve=()=>{const{currentUser:a,authenticateUser:t}=I(),[n,v]=s.exports.useState([]),[c,l]=s.exports.useState([]),[p,i]=s.exports.useState(null);s.exports.useContext(w),s.exports.useEffect(()=>{localStorage.getItem("authToken")&&t()},[]);const o=h=>{l([...c,h])};return c.find(h=>h._id===p),n?e("div",{children:r("div",{className:"dashboard",children:[e("div",{className:"profil",children:e(ge,{})}),e("div",{className:"creatChan",children:e(he,{addChan:o})}),e("div",{className:"chanList",children:e(pe,{setChans:l,chans:c})})]})}):e("p",{children:" loading..."})},Ce=()=>{const{isLoggedIn:a,isLoading:t}=I();return t?e("p",{children:"Loading..."}):a?e(te,{}):e(ee,{to:"/login"})},xe=()=>r("div",{children:[e("p",{children:"Sorry, it seems you're looking for something that doesn't exist..."}),e(_,{to:"/",children:"\u{1F3B5} Take me home, to the place I belong \u{1F3B5}"})]});const Ne=()=>{const[a,t]=s.exports.useState(""),[n,v]=s.exports.useState([]),{joinChan:c,socket:l,welcomeMess:p}=s.exports.useContext(w),{currentUser:i}=I(),[o,h]=s.exports.useState(""),f=()=>{b.get(`/chan/${c}/messages`).then(d=>{v(d.data)}).catch(d=>console.error(d))};s.exports.useEffect(()=>{f()},[]);const g=d=>{d.preventDefault(),a!==""&&(l.emit("send-message",{content:a,author:i._id,chan:c}),t(""),f())};return l.on("receive-message",d=>{console.log("message received",d),f()}),r("div",{className:"chat-container",children:[e(ae,{children:r("div",{className:"sentMessages",children:[e("h2",{className:"sentMessages-title",children:"\u{1F408} Chat \u{1F408}"}),n.map(d=>r("div",{className:`sentMessages-text ${d.author._id===i._id?"author":"not-author"}`,children:[r("div",{className:"sentMessages-header",children:[e("img",{src:d.author.avatar,alt:d.author.username}),e("p",{className:"sentMessages-author",children:`${d.author._id===i._id?"Sent by you":`Sent by ${d.author.username}`}`})]}),r("div",{className:"sentMessages-main-card",children:[e("p",{id:d._id,className:"sentMessages-content",children:d.content}),e("div",{className:`sentMessages-text ${d.author._id===i._id?"edit-visible":"edit-not-visible"}`,children:e(se,{type:"text",value:o,onSave:async y=>{document.getElementById(d._id).remove(),t(y),await b.patch(`/chan/messages/${d._id}`,y)}})})]})]},d._id))]})}),e("p",{children:p}),r("div",{className:"sendMessage",children:[e("input",{type:"text",value:a,placeholder:"Write something witty here",onChange:d=>t(d.target.value),onKeyPress:d=>{d.key==="Enter"&&g(d)}}),e("div",{className:"send-icon",children:e("i",{class:"fa-solid fa-paper-plane",onClick:g,Submit:!0})})]})]})},be=()=>{const{connectedUsers:a,userUpdated:t}=s.exports.useContext(w);return s.exports.useEffect(()=>{console.log("is user updated ?",t)},[a,t]),console.log("Component{UsersList} => connectedUsers",a),r("div",{className:"users-list",children:[e("p",{children:" Who is around ?"}),a.map(n=>n.self?e("div",{className:"user",children:e("span",{className:"user-p",children:"\u{1F7E2} You (obviously) \u{1F981}"})},n._id):e("div",{className:"user",children:r("span",{className:"user-p",children:["\u{1F7E2}",n.username]})},n._id))]})};function ye(){s.exports.useState({});const{joinChan:a}=s.exports.useContext(w),[t,n]=s.exports.useState({});return s.exports.useEffect(()=>{console.log(a),b.get(`/chan/${a}`).then(v=>{n(c=>v.data)}).catch(v=>console.error(v))},[]),t?(console.log(t),r("div",{className:"channel-global-container",children:[r("div",{className:"chan-head",children:[e("div",{className:"chan-head-img",children:e("img",{src:t.image,alt:t.name})}),r("h2",{children:[" ",t.name]}),e(_,{to:"/dashboard",className:"chan-head-leave-link",children:e("i",{class:"fa-solid fa-arrow-right-from-bracket"})})]}),r("div",{className:"channel-main",children:[e(be,{}),e(Ne,{})]})]})):e("p",{children:" loading..."})}const Se=s.exports.createContext(),ke=()=>(s.exports.useContext(Se),console.log(getMedia),r("div",{children:[e("h2",{children:"VideoPage - this is a last minute "}),r("div",{className:"video-chat-container",children:[e("h2",{className:"talk-info",id:"talking-with-info",children:"Select active user on the left menu."}),r("div",{class:"video-container",children:[e("video",{autoplay:!0,className:"remote-video",id:"remote-video"}),e("video",{value:localVideoRef,autoplay:!0,muted:!0,className:"local-video",id:"local-video"})]})]})]}));function Ee(){return e("div",{className:"App",children:r(ne,{children:[e(M,{path:"/",element:e(ie,{})}),e(M,{path:"/login",element:e(de,{})}),r(M,{element:e(Ce,{}),children:[e(M,{path:"/dashboard",element:e(ve,{})}),e(M,{path:"/chan/:id",element:e(ye,{})})]}),e(M,{path:"/video",element:e(ke,{})}),e(M,{path:"*",element:e(xe,{})})]})})}const Le=s.exports.createContext();function we(a){const[t,n]=s.exports.useState([]);return e(Le.Provider,{value:{users:t,setUsers:n},children:a.children})}re.render(e(V.StrictMode,{children:e(oe,{children:e(le,{children:e(ue,{children:e(we,{children:e("videoContextWrapper",{children:e(Ee,{})})})})})})}),document.getElementById("root"));
