var J=Object.defineProperty,K=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var q=(n,t,a)=>t in n?J(n,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[t]=a,y=(n,t)=>{for(var a in t||(t={}))Q.call(t,a)&&q(n,a,t[a]);if(Y)for(var a of Y(t))X.call(t,a)&&q(n,a,t[a]);return n},b=(n,t)=>K(n,G(t));import{a as B,j as O,R as V,r as s,u as z,L as D,l as Z,N as ee,O as te,b as ne,c as I,d as se,B as ae}from"./vendor.b6c3d911.js";const re=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))f(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const p of l.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&f(p)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function f(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}};re();const A=B.create({baseURL:"https://projet3-discord.herokuapp.com",withCredentials:!0});A.interceptors.request.use(n=>{const t=localStorage.getItem("authToken");return n.headers.Authorization=t?`Bearer ${t}`:"",n});function W(n){throw n.response.data&&console.log(n.response&&n.response.data),n}const N=b(y({},A),{signup(n){return A.post("/signup",n).then(t=>t.data).catch(W)},isLoggedIn(n){return A.get("/auth/verify",{headers:{Authorization:`Bearer ${n}`}}).then(t=>t.data).catch(W)},signin(n){return A.post("/login",n).then(t=>t.data).catch(W)}}),e=O.exports.jsx,i=O.exports.jsxs,H=O.exports.Fragment,$=V.createContext();function oe({children:n}){const[t,a]=s.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});s.exports.useEffect(()=>{f()},[]);const f=()=>{const o=localStorage.getItem("authToken");o?N.isLoggedIn(o).then(u=>{a({currentUser:u,isLoading:!1,isLoggedIn:!0})}).catch(u=>{a({currentUser:null,isLoading:!1,isLoggedIn:!1})}):a({currentUser:null,isLoading:!1,isLoggedIn:!1})},r=()=>{l(),f()},l=()=>{localStorage.removeItem("authToken")},p=o=>{localStorage.setItem("authToken",o)},d={currentUser:t.currentUser,isLoading:t.isLoading,isLoggedIn:t.isLoggedIn,storeToken:p,authenticateUser:f,removeUser:r,removeToken:l};return e($.Provider,{value:d,children:n})}const ce=()=>{const[n,t]=s.exports.useState({username:"",email:"",password:""});s.exports.useState();const[a,f]=s.exports.useState(void 0),{authenticateUser:r,isLoggedIn:l}=s.exports.useContext($),p=s.exports.useRef(null),d=z();s.exports.useEffect(()=>{r(),l&&d("/dashboard")},[l]);const o=c=>{B.get(`https://avatars.dicebear.com/api/bottts/${c}.svg`).then(({data:g})=>{p.current=g}).catch(g=>console.log(g))};return i("div",{children:[i("form",{className:"form",onSubmit:async c=>{c.preventDefault();try{await B.post("https://projet3-discord.herokuapp.com/signup",n),d("/login")}catch(g){f(k=>g.response.data.message),console.error(g)}},children:[e("label",{className:"form-label",htmlFor:"username",children:"username"}),e("input",{className:"form-input",placeholder:"Enter your Username",type:"text",name:"username",value:n.username,onChange:c=>{t(b(y({},n),{username:c.target.value})),o(c.target.value)}}),e("label",{className:"form-label",htmlFor:"email",children:"email"}),e("input",{placeholder:"Enter your Email",className:"form-input",type:"text",name:"email",value:n.email,onChange:c=>t(b(y({},n),{email:c.target.value}))}),e("label",{className:"form-label",htmlFor:"password",children:"password"}),e("input",{placeholder:"Enter your password",className:"form-input",type:"text",name:"password",value:n.password,onChange:c=>t(b(y({},n),{password:c.target.value}))}),i("div",{children:[e("p",{children:"This will be your profile pic"}),e("img",{src:`https://avatars.dicebear.com/api/bottts/${n.username}.svg`,alt:""})]}),e("button",{children:"Sign up"})]}),a&&e("p",{className:"error-message",children:a}),e(D,{to:"/login",children:" Already have an account ? Click here to login"})]})},le=()=>{const[n,t]=s.exports.useState({email:"",password:""}),[a,f]=s.exports.useState(void 0),{storeToken:r,authenticateUser:l,isLoggedIn:p}=s.exports.useContext($),d=z();return s.exports.useEffect(()=>{l(),p&&d("/dashboard")},[p]),i("div",{children:[i("form",{className:"form",onSubmit:async u=>{u.preventDefault();try{const c=await N.post("/login",n);r(c.data.authToken),l(),d("/dashboard")}catch(c){const g=c.response.data.message;f(g)}},children:[e("label",{className:"form-label",htmlFor:"email",children:"email"}),e("input",{placeholder:"Enter your Email",className:"form-input",type:"text",name:"email",value:n.email,onChange:u=>t(b(y({},n),{email:u.target.value}))}),e("label",{className:"form-label",htmlFor:"password",children:"password"}),e("input",{placeholder:"Enter your password",className:"form-input",type:"text",name:"password",value:n.password,onChange:u=>t(b(y({},n),{password:u.target.value}))}),e("button",{children:"Log in"})]}),a&&e("p",{className:"error-message",children:a}),e(D,{to:"/",children:" Not a member yet ? Sign-up !"})]})},M=()=>s.exports.useContext($);const w=V.createContext();function ie(n){const{currentUser:t,isLoggedIn:a}=M(),[f,r]=s.exports.useState([]),[l,p]=s.exports.useState(!1),[d,o]=s.exports.useState({}),[u,c]=s.exports.useState([]),[g,k]=s.exports.useState(null),L=v=>{c([...u,v])},[E,_]=s.exports.useState([]),[T,F]=s.exports.useState(""),R=localStorage.getItem("authToken"),U=s.exports.useRef();s.exports.useEffect(()=>{console.log("---> chans from socket context are",u)},[u]),s.exports.useEffect(()=>{if(!a)return;const v=Z("https://projet3-discord.herokuapp.com",{withCredentials:!0});return v.on("connected",()=>{console.log("CurrentUser",t),console.log("socket",v),console.log("succesfully connected with socket.io server")}),v.auth={email:t==null?void 0:t.email,id:t==null?void 0:t._id,token:R},v.on("users",m=>{m.map(x=>{x.self=x._id===v.auth.id}),m=m.sort((x,S)=>x.self?-1:S.self?1:x.username<S.username?-1:x.username>S.username?1:0),r(x=>m)}),g!==null&&v.emit("chan-join",g),v.on("user joined",m=>{F(m)}),v.emit("user update",l),v.on("disconnect",()=>{console.log("user just disconnected")}),v.on("user disconnected",()=>{console.log("disconnected user is",v.id)}),U.current=v,()=>{v.disconnect(),U.current=null}},[a,g]);const j={socket:U.current,connectedUsers:f,userUpdated:l,setUserUpdated:p,setNewChan:o,chans:u,setChans:c,addChan:L,joinChan:g,setJoinChan:k,prevMess:E};return e(w.Provider,{value:j,children:n.children})}const de=()=>{const{currentUser:n}=M(),{chans:t,setChans:a,addChan:f}=s.exports.useContext(w),r=n._id,[l,p]=s.exports.useState({name:"",owner:r}),[d,o]=s.exports.useState({name:"",image:""}),[u,c]=s.exports.useState(!1),[g,k]=s.exports.useState(!1),L=s.exports.useRef(),[E,_]=s.exports.useState(!1),[T,F]=s.exports.useState([]);s.exports.useEffect(()=>{N.get("/chan").then(h=>{console.log("SERIOUSLY ?? db reponse just before setChans =>",h.data),a(h.data)}).catch(h=>console.error(h))},[E]),s.exports.useEffect(()=>{console.log("useEffect : where are the chans ? :",t),F(t.filter(h=>h.owner._id===r))},[E,t,l]);const R=async h=>{h.preventDefault;try{const C=await N.post("/chan",l);_(!0),f(C.data),_(!1),p(b(y({},l),{name:""}))}catch(C){console.error(C)}},U=h=>{N.get(`/chan/${h}`).then(C=>{o(C.data),console.log(C.data)}).catch(C=>{console.error(C)}),c(!0)},j=async h=>{h.preventDefault();const C=new FormData;C.append("name",d.name),C.append("image",L.current.files[0]);try{console.log("chanToUpdate",d);const P=await N.patch(`/chan/${d._id}`,C);o(ke=>P.data),c(!u)}catch(P){console.error(P)}},v=h=>{h.preventDefault(),c(!1)},m=h=>{h.preventDefault(),k(!0)},x=h=>{h.preventDefault(),k(!1),c(!0)},S=async h=>{try{await N.delete(`/chan/${d._id}`),k(!1),c(!1)}catch{}};return t?i("div",{children:[u&&i("div",{children:[e("h2",{children:"Edit your channel"}),i("form",{className:"formEdit-form",children:[e("label",{className:"formEdit-label",htmlFor:"name",children:"Name"}),e("input",{className:"formEdit-input",type:"text",value:d.name,onChange:h=>o(b(y({},d),{name:h.target.value}))}),e("label",{className:"formEdit-label",htmlFor:"name",children:"Image"}),e("input",{className:"formEdit-input-file",ref:L,type:"file",name:"image"}),e("button",{onClick:j,children:"Edit"}),e("button",{onClick:v,children:"Cancel Edit"}),e("button",{onClick:m,children:"Delete Chan"})]})]}),g&&i("div",{className:"formEdit-deleteMode",children:[e("p",{children:"Are you sure ?r"}),e("button",{onClick:x,children:"Nope nope nopity nope"}),e("button",{onClick:S,children:"Delete for good"})]}),!u&&i("div",{className:"chanlist",children:[i("div",{className:"chanList-header",children:[e("h2",{children:"Chan List Perso"}),i("div",{className:"create-chan",children:[e("input",{placeholder:"Enter a name for a new channel",type:"text",id:"name",value:l.name,onChange:h=>p(b(y({},l),{name:h.target.value}))}),e("span",{onClick:R,children:"Create"})]})]}),e("div",{className:"chanList-content",children:T.map(h=>i("div",{className:"chanList-chan",children:[e(D,{to:`/chan/${h._id}`,children:i("div",{className:"chanList-chan-content",children:[e("img",{className:"chanList-image",src:h.image,alt:h.name}),e("h4",{children:h.name})]})}),e("div",{className:"chanList-editBtn",children:e("i",{className:"fa-solid fa-wrench ",onClick:()=>U(h._id)})})]},h._id+"filtered"))})]})]}):e("p",{children:"loading..."})},ue=({searchChan:n,callbackSearch:t})=>e(H,{children:e("input",{type:"text",placeholder:"Search for a specific chan",value:n,onChange:a=>t(a.target.value)})}),he=()=>{const{chans:n,setChans:t,setJoinChan:a,joinChan:f}=s.exports.useContext(w),[r,l]=s.exports.useState("");if(!n)return e("p",{children:"loading..."});s.exports.useEffect(()=>{N.get("/chan").then(d=>t(d.data)).catch(d=>console.error(d))},[]);let p=null;return r!==""?p=n.filter(d=>d.name.toLowerCase().includes(r.toLowerCase())):p=n,e(H,{children:i("div",{className:"chanlist",children:[i("div",{className:"chanList-header",children:[e("h2",{children:"All channels"}),e("div",{className:"searChan",children:e(ue,{searchChan:r,callbackSearch:l})})]}),e("div",{className:"chanList-content",children:p.map(d=>e("div",{className:"chanList-chan",children:e(D,{onClick:()=>{a(o=>d._id)},to:`/chan/${d._id}`,children:i("div",{className:"chanList-chan-content",children:[e("img",{className:"chanList-image",src:d.image,alt:d.name}),e("h4",{children:d.name})]})})},d._id+"chan"))})]})})};const me=()=>{const{currentUser:n,isLoggedIn:t,removeUser:a,storeToken:f,authenticateUser:r}=M(),{socket:l,setUserUpdated:p,userUpdated:d}=s.exports.useContext(w),[o,u]=s.exports.useState({_id:"",username:"",email:"",avatar:""}),[c,g]=s.exports.useState(!1),[k,L]=s.exports.useState(!1),E=s.exports.useRef();s.exports.useEffect(()=>{n&&N.get("/user",n._id).then(m=>{u(m.data)}).catch(m=>{console.log(m)}),t||u(null)},[t]);const _=m=>{m.preventDefault(),g(!0)},T=async m=>{m.preventDefault();const x=new FormData;x.append("username",o.username),x.append("email",o.email),x.append("avatar",E.current.files[0]),console.log("the current avatar ref is :",E.current.files[0]);try{const S=await N.patch(`/user/${o._id}`,x,{headers:{"content-type":"multipart/form-data"}});f(S.data.authToken),r(),u(h=>S.data.payload),p(!0),g(!c),p(!1)}catch(S){console.error(S)}},F=async m=>{m.preventDefault(),l.disconnect(),a()},R=m=>{m.preventDefault(),L(!0)},U=m=>{m.preventDefault(),L(!1),g(!0)},j=m=>{m.preventDefault(),g(!1)},v=async m=>{m.preventDefault();try{await N.delete(`/user/${o._id}`),l.disconnect(),a(),L(!1),g(!1)}catch(x){console.error(x)}};return n?i("div",{children:[k&&i("div",{className:"delete-mode container",children:[e("p",{children:"Are you sure ? This means goodbye... forever"}),e("button",{className:"profil-btn",onClick:U,children:"Nope nope nopity nope"}),e("button",{className:"profil-btn",onClick:v,children:"Delete for good"})]}),c&&i("form",{className:"edit-mode container",children:[e("label",{htmlFor:"username",children:"Username"}),e("input",{type:"text",id:"username",value:o.username,onChange:m=>{u(b(y({},o),{username:m.target.value}))}}),e("label",{htmlFor:"email",children:"Email"}),e("input",{type:"text",id:"email",value:o.email,onChange:m=>{u(b(y({},o),{email:m.target.value}))}}),e("label",{htmlFor:"avatar",children:"avatar"}),e("input",{type:"file",name:"avatar",id:"avatar",ref:E}),e("button",{className:"profil-btn",onClick:T,children:"Send"}),i("button",{className:"profil-btn",onClick:j,children:[" ","Nevermind, this is fine"]}),e("button",{className:"profil-btn",onClick:R,children:"Delete my account"})]}),!c&&i("div",{className:"display-mode container",children:[e("p",{className:"display-mode username",children:o==null?void 0:o.username}),e("p",{className:"display-mode email",children:o==null?void 0:o.email}),e("img",{className:"display-mode avatar",src:o==null?void 0:o.avatar,alt:o==null?void 0:o.username}),i("div",{className:"display-mode icons-container",children:[e("i",{className:"fas fa-user-edit display-mode icon",onClick:_}),e("i",{onClick:F,className:"fa-solid fa-right-from-bracket display-mode icon"})]})]})]}):e("p",{children:"loading"})},pe=()=>i("div",{className:"profil__container",children:[e("h2",{children:"Your profile"}),e(me,{})]}),fe=()=>{const{currentUser:n,authenticateUser:t}=M(),[a,f]=s.exports.useState([]),[r,l]=s.exports.useState([]),[p,d]=s.exports.useState(null);s.exports.useContext(w),s.exports.useEffect(()=>{localStorage.getItem("authToken")&&t()},[]);const o=u=>{l([...r,u])};return r.find(u=>u._id===p),a?e("div",{children:i("div",{className:"dashboard",children:[e("div",{className:"profil",children:e(pe,{})}),e("div",{className:"creatChan",children:e(de,{addChan:o})}),e("div",{className:"chanList",children:e(he,{setChans:l,chans:r})})]})}):e("p",{children:" loading..."})},ge=()=>{const{isLoggedIn:n,isLoading:t}=M();return t?e("p",{children:"Loading..."}):n?e(te,{}):e(ee,{to:"/login"})},ve=()=>i("div",{children:[e("p",{children:"Sorry, it seems you're looking for something that doesn't exist..."}),e(D,{to:"/",children:"\u{1F3B5} Take me home, to the place I belong \u{1F3B5}"})]}),xe=()=>{const[n,t]=s.exports.useState(""),[a,f]=s.exports.useState([]),{joinChan:r,socket:l,welcomeMess:p}=s.exports.useContext(w),{currentUser:d}=M();s.exports.useState(!1);const o=()=>{console.log(r),N.get(`/chan/${r}/messages`).then(c=>{f(c.data)}).catch(c=>console.error(c))};s.exports.useEffect(()=>{o()},[]);const u=c=>{c.preventDefault(),n!==""&&(l.emit("send-message",{content:n,author:d._id,chan:r}),t(""),o())};return l.on("receive-message",c=>{console.log("message received",c),o()}),i("div",{children:[i("div",{className:"sentMessages",children:[e("h2",{children:"chat"}),a.map(c=>i("div",{children:[e("p",{children:c.content}),i("p",{children:["Sent by ",c.author.username]})]},c._id))]}),e("p",{children:p}),i("div",{className:"sendMessage",children:[e("input",{type:"text",value:n,onChange:c=>t(c.target.value)}),e("button",{onClick:u,children:"Submit"})]})]})},Ce=()=>{const{connectedUsers:n,userUpdated:t}=s.exports.useContext(w);return s.exports.useEffect(()=>{console.log("is user updated ?",t)},[n,t]),console.log("Component{UsersList} => connectedUsers",n),i("div",{children:[e("p",{children:" users list"}),n.map(a=>a.self?e("div",{children:i("p",{children:[a.username,"(yourself)"]})},a._id):e("div",{children:e("p",{children:a.username})},a._id))]})};function Ne(){s.exports.useState({});const{joinChan:n}=s.exports.useContext(w),[t,a]=s.exports.useState({});return s.exports.useEffect(()=>{console.log(n),N.get(`/chan/${n}`).then(f=>{a(r=>f.data)}).catch(f=>console.error(f))},[]),t?(console.log(t),i("div",{className:"channel-main",children:[i("h2",{children:[" You are on ",t.name]}),e("img",{src:t.image,alt:t.name,style:{width:"100px",borderRadius:"50%"}}),e(D,{to:"/dashboard",children:"Leave this chat"}),e(Ce,{}),e(xe,{})]})):e("p",{children:" loading..."})}function ye(){return e("div",{className:"App",children:i(ne,{children:[e(I,{path:"/",element:e(ce,{})}),e(I,{path:"/login",element:e(le,{})}),i(I,{element:e(ge,{}),children:[e(I,{path:"/dashboard",element:e(fe,{})}),e(I,{path:"/chan/:id",element:e(Ne,{})})]}),e(I,{path:"*",element:e(ve,{})})]})})}const be=s.exports.createContext();function Se(n){const[t,a]=s.exports.useState([]);return e(be.Provider,{value:{users:t,setUsers:a},children:n.children})}se.render(e(V.StrictMode,{children:e(ae,{children:e(oe,{children:e(ie,{children:e(Se,{children:e(ye,{})})})})})}),document.getElementById("root"));
